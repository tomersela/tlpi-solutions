# demo_rtsigio.c
```diff
--- ./demo_sigio.c	2025-10-15 01:25:56.501073991 +0300
+++ ./demo_rtsigio.c	2025-10-15 01:26:32.245281469 +0300
@@ -10,10 +10,11 @@
 
 /* Listing 63-3 */
 
-/* demo_sigio.c
+/* demo_rtsigio.c
 
-   A trivial example of the use of signal-driven I/O.
+   A trivial example of the use of signal-driven I/O with real-time signals.
 */
+#define _GNU_SOURCE
 #include <signal.h>
 #include <ctype.h>
 #include <fcntl.h>
@@ -25,8 +26,9 @@
                                 /* Set nonzero on receipt of SIGIO */
 
 static void
-sigioHandler(int sig)
+sigioHandler(int sig, siginfo_t *si, void *ucontext)
 {
+    printf("Got signal %d: si_fd=%d, si_code=%d\n", sig, si->si_fd, si->si_code);
     gotSigio = 1;
 }
 
@@ -42,11 +44,16 @@
     /* Establish handler for "I/O possible" signal */
 
     sigemptyset(&sa.sa_mask);
-    sa.sa_flags = SA_RESTART;
-    sa.sa_handler = sigioHandler;
-    if (sigaction(SIGIO, &sa, NULL) == -1)
+    sa.sa_flags = SA_RESTART | SA_SIGINFO;
+    sa.sa_sigaction = sigioHandler;
+    if (sigaction(SIGRTMIN, &sa, NULL) == -1)
         errExit("sigaction");
 
+    /* Set signal to be used for I/O notification */
+    
+    if (fcntl(STDIN_FILENO, F_SETSIG, SIGRTMIN) == -1)
+        errExit("fcntl(F_SETSIG)");
+
     /* Set owner process that is to receive "I/O possible" signal */
 
     if (fcntl(STDIN_FILENO, F_SETOWN, getpid()) == -1)
```

# Testing
Testing the signal-queueing behavior is difficult with keyboard input. The main observable difference is the additional information provided by the signal handler: the file descriptor (`si_fd`) and signal code (`si_code`) from the `siginfo_t` structure.

Running and typing "testing":
```
$ ./demo_rtsigio 
Got signal 34: si_fd=0, si_code=1
cnt=34; read t
Got signal 34: si_fd=0, si_code=1
cnt=38; read e
Got signal 34: si_fd=0, si_code=1
cnt=45; read s
Got signal 34: si_fd=0, si_code=1
cnt=51; read t
Got signal 34: si_fd=0, si_code=1
cnt=58; read i
Got signal 34: si_fd=0, si_code=1
cnt=61; read n
Got signal 34: si_fd=0, si_code=1
cnt=62; read g

$ 
```
